<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Document Processing - AI Codebase Documentation</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #f093fb;
            --dark: #1a1d2e;
            --light: #f8f9ff;
            --border: #e5e7eb;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            color: #666;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            border: 2px solid var(--border);
            background: white;
            color: #666;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-color: transparent;
        }

        .content-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 2em;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary);
        }

        .architecture-diagram {
            background: var(--light);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }

        .flow-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .flow-step {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border-left: 5px solid var(--primary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .flow-step:hover {
            transform: translateX(10px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.2);
        }

        .step-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content h3 {
            color: var(--primary);
            margin-bottom: 8px;
        }

        .step-content p {
            color: #666;
            line-height: 1.6;
        }

        .code-block {
            background: var(--dark);
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .code-block .keyword { color: #c792ea; }
        .code-block .string { color: #c3e88d; }
        .code-block .function { color: #82aaff; }
        .code-block .comment { color: #697098; }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: var(--light);
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }

        .feature-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .feature-card ul {
            list-style: none;
            padding-left: 0;
        }

        .feature-card li {
            padding: 8px 0;
            color: #666;
            position: relative;
            padding-left: 25px;
        }

        .feature-card li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--primary);
            font-weight: bold;
        }

        .api-endpoint {
            background: white;
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .api-endpoint .method {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            margin-right: 10px;
            font-size: 0.9em;
        }

        .api-endpoint .method.post {
            background: #10b981;
            color: white;
        }

        .api-endpoint .method.get {
            background: #3b82f6;
            color: white;
        }

        .api-endpoint .path {
            font-family: 'Courier New', monospace;
            color: var(--primary);
            font-size: 1.1em;
        }

        .api-endpoint .description {
            margin-top: 10px;
            color: #666;
            line-height: 1.6;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }

        .tech-badge {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 25px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .back-link {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            margin-top: 20px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .back-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .sidebar { position: fixed; left: 0; top: 0; width: 250px; height: 100vh; background: #1e293b; color: white; padding: 0; z-index: 1000; box-shadow: 4px 0 15px rgba(0,0,0,0.2); overflow-y: auto; }
        .sidebar-header { padding: 25px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-bottom: 3px solid rgba(255,255,255,0.1); }
        .sidebar-header h2 { font-size: 1.3em; font-weight: 700; margin: 0; }
        .sidebar-item { padding: 15px 20px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 12px; border-left: 4px solid transparent; }
        .sidebar-item:hover { background: #334155; border-left-color: #667eea; }
        .sidebar-item.active { background: #334155; border-left-color: #667eea; font-weight: 600; }
        .sidebar-item .icon { font-size: 1.2em; width: 24px; text-align: center; }
        .sidebar-divider { height: 1px; background: rgba(255,255,255,0.1); margin: 15px 0; }
        .sidebar-section { margin: 10px 0; }
        .section-header { padding: 15px 20px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 12px; border-left: 4px solid transparent; position: relative; }
        .section-header:hover { background: #334155; }
        .section-header .arrow { position: absolute; right: 20px; transition: transform 0.3s ease; font-size: 0.8em; }
        .section-header.expanded .arrow { transform: rotate(-180deg); }
        .section-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; background: #0f172a; }
        .section-content.expanded { max-height: 500px; }
        .sidebar-subitem { padding: 12px 20px 12px 56px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 10px; font-size: 0.95em; opacity: 0.9; }
        .sidebar-subitem:hover { background: #1e293b; opacity: 1; padding-left: 60px; }
        .sidebar-subitem .icon { font-size: 1.1em; }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script>
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId + '-section');
            const header = event.currentTarget;
            if (section.classList.contains('expanded')) {
                section.classList.remove('expanded');
                header.classList.remove('expanded');
            } else {
                section.classList.add('expanded');
                header.classList.add('expanded');
            }
        }
        
        function showComingSoon(feature) {
            alert(`${feature} feature coming soon! This will be implemented in a future update.`);
        }
    </script>
</head>
<body>
    <div class="container" style="margin-left: 250px;">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>üìÑ IDP System</h2>
            </div>
            
            <div class="sidebar-item" onclick="window.location.href='/dashboard'">
                <span class="icon">üìä</span>
                <span>Dashboard</span>
            </div>
            
            <div class="sidebar-item active">
                <span class="icon">üìñ</span>
                <span>Codebase</span>
            </div>
            
            <div class="sidebar-divider"></div>
            
            <div class="sidebar-section">
                <div class="section-header" onclick="toggleSection('admin')">
                    <span class="icon">‚öôÔ∏è</span>
                    <span>Admin</span>
                    <span class="arrow" id="admin-arrow">‚ñº</span>
                </div>
                <div class="section-content" id="admin-section">
                    <div class="sidebar-subitem" onclick="showComingSoon('Users')">
                        <span class="icon">üë•</span>
                        <span>Users</span>
                    </div>
                    <div class="sidebar-subitem" onclick="showComingSoon('Configuration')">
                        <span class="icon">üîß</span>
                        <span>Configuration</span>
                    </div>
                    <div class="sidebar-subitem" onclick="showComingSoon('Settings')">
                        <span class="icon">‚öôÔ∏è</span>
                        <span>Settings</span>
                    </div>
                    <div class="sidebar-subitem" onclick="showComingSoon('Help')">
                        <span class="icon">‚ùì</span>
                        <span>Help</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="header" style="margin-left: 0;">
            <h1>üìÑ Universal IDP System</h1>
            <p>AI-Powered Intelligent Document Processing - Complete Documentation</p>
        </div>

        <div class="nav-tabs" style="margin-left: 0;">
            <button class="tab-btn active" onclick="showTab('overview')">üìã Overview</button>
            <button class="tab-btn" onclick="showTab('howto')">üöÄ How To Use</button>
            <button class="tab-btn" onclick="showTab('optimizations')">‚ö° Optimizations</button>
            <button class="tab-btn" onclick="showTab('architecture')">üèóÔ∏è Architecture</button>
            <button class="tab-btn" onclick="showTab('features')">‚ú® Features</button>
            <button class="tab-btn" onclick="showTab('api')">üîå API</button>
            <button class="tab-btn" onclick="showTab('tech')">üíª Tech Stack</button>
            <button class="tab-btn" onclick="showTab('setup')">‚öôÔ∏è Setup</button>
        </div>

        <!-- Overview Section -->
        <div id="overview" class="content-section active">
            <h2 class="section-title">Project Overview</h2>
            
            <p style="font-size: 1.1em; line-height: 1.8; color: #666; margin-bottom: 30px;">
                <strong>Universal IDP System</strong> is an AI-powered document processing platform that automatically extracts, 
                classifies, and structures data from ANY document type. The system uses Amazon Textract for OCR, AWS Bedrock 
                (Claude 3.5 Sonnet) for intelligent field extraction, and provides a comprehensive dashboard for managing all 
                processed documents with persistent storage.
            </p>
            
            <div style="background: #f0fdf4; padding: 20px; border-radius: 10px; border-left: 4px solid #10b981; margin-bottom: 30px;">
                <h3 style="color: #10b981; margin-bottom: 10px;">üéØ What This System Does</h3>
                <ul style="line-height: 1.8; margin-left: 20px; color: #666;">
                    <li>Upload documents (PDF, PNG, JPG, TXT) through a simple interface</li>
                    <li>Automatically runs OCR using Amazon Textract (3-tier processing)</li>
                    <li>Detects document type using hybrid keyword + AI classification</li>
                    <li>Extracts up to 20 key fields with intelligent field naming</li>
                    <li>For loan documents: Splits into multiple accounts automatically</li>
                    <li>Calculates accuracy scores for data quality assessment</li>
                    <li>Saves all results to persistent storage (JSON database)</li>
                    <li>Displays results in beautiful tables with proper formatting</li>
                    <li>Provides dashboard to view all processed documents</li>
                </ul>
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <h3>üéØ Purpose</h3>
                    <ul>
                        <li>Universal document processing</li>
                        <li>12+ supported document types</li>
                        <li>Automatic type detection</li>
                        <li>Smart field extraction (up to 20 fields)</li>
                        <li>Persistent document storage</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h3>üöÄ Key Benefits</h3>
                    <ul>
                        <li>Multi-format support (PDF, PNG, JPG, TXT)</li>
                        <li>Amazon Textract OCR integration</li>
                        <li>3-tier PDF processing (Sync/Async/PyPDF2)</li>
                        <li>Real-time status tracking</li>
                        <li>Comprehensive dashboard</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h3>üìä Supported Documents</h3>
                    <ul>
                        <li>üíç Marriage Certificates</li>
                        <li>üìú Death Certificates</li>
                        <li>üíº Business Cards</li>
                        <li>üßæ Invoices & Receipts</li>
                        <li>üè¶ Loan/Account Documents</li>
                        <li>ü™™ Driver's Licenses</li>
                        <li>üõÇ Passports</li>
                        <li>üìù Contracts & more</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- How To Use Section -->
        <div id="howto" class="content-section">
            <h2 class="section-title">üöÄ How To Use The System</h2>
            
            <div style="background: #e3f2fd; padding: 25px; border-radius: 10px; margin-bottom: 30px;">
                <h3 style="color: #1976d2; margin-bottom: 15px;">Quick Start Guide</h3>
                <p style="line-height: 1.8; color: #666;">Follow these simple steps to process your first document:</p>
            </div>

            <div class="flow-container">
                <div class="flow-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Access Dashboard</h3>
                        <p>Navigate to <strong>http://localhost:5015/dashboard</strong> - This is your main page showing all processed documents (starts empty)</p>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Click "Create" Button</h3>
                        <p>Click the blue "+ Create" button in the toolbar. A modal popup will appear asking for document details.</p>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Enter Document Name</h3>
                        <p>Type a descriptive name for your document (e.g., "John Doe Marriage Certificate", "ABC Corp Invoice"). This name will appear in the dashboard.</p>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>Upload Your Document</h3>
                        <p>Click the upload area or drag & drop your file. Supported formats: <strong>PDF, PNG, JPG, JPEG, TXT</strong>. Maximum size: 500MB.</p>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h3>Click "Create" to Process</h3>
                        <p>Click the blue "Create" button in the modal. The modal will close immediately and processing starts in the background.</p>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-number">6</div>
                    <div class="step-content">
                        <h3>Wait for Processing</h3>
                        <p>A green notification appears: "Document is being processed...". Processing time: 10-30 seconds for text files, 1-2 minutes for scanned PDFs.</p>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-number">7</div>
                    <div class="step-content">
                        <h3>View Results</h3>
                        <p>When complete, you'll see "‚úÖ Document processed successfully!" and the document appears in the dashboard table with icon, name, date, type, and accuracy score.</p>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-number">8</div>
                    <div class="step-content">
                        <h3>Click to View Details</h3>
                        <p>Click any row in the table to open the full document details in a new tab. You'll see all extracted fields, tables for Signers/SupportingDocuments, and accuracy information.</p>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--primary); margin: 30px 0 20px 0;">üìã Understanding the Dashboard</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>Document Icon</h3>
                    <ul>
                        <li>Shows detected document type</li>
                        <li>üíç Marriage Certificate</li>
                        <li>üè¶ Loan Document</li>
                        <li>üìú Death Certificate</li>
                        <li>And 9 more types...</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h3>Accuracy Score</h3>
                    <ul>
                        <li>Color-coded progress bar</li>
                        <li>üü¢ Green: 80-100% (Excellent)</li>
                        <li>üü° Orange: 60-79% (Good)</li>
                        <li>üî¥ Red: 0-59% (Needs Review)</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h3>Search & Filter</h3>
                    <ul>
                        <li>Search by filename</li>
                        <li>Search by document type</li>
                        <li>Real-time filtering</li>
                        <li>Case-insensitive</li>
                    </ul>
                </div>
            </div>

            <h3 style="color: var(--primary); margin: 30px 0 20px 0;">üè¶ Special: Loan Documents</h3>
            <p style="line-height: 1.8; color: #666; margin-bottom: 15px;">
                When you upload a loan/account document, the system automatically:
            </p>
            <ul style="line-height: 1.8; margin-left: 20px; color: #666;">
                <li><strong>Splits into multiple accounts</strong> using smart regex patterns</li>
                <li><strong>Processes each account separately</strong> with specialized prompts</li>
                <li><strong>Extracts key fields per account:</strong> AccountNumber, AccountHolderNames, AccountType, OwnershipType, WSFSAccountType, AccountPurpose, SSN, Signers, SupportingDocuments</li>
                <li><strong>Page-by-page viewer</strong> with document image on left, extracted data on right</li>
                <li><strong>Smart field display:</strong> Only shows fields with actual data (hides N/A and empty fields)</li>
                <li><strong>Color-coded accuracy badges:</strong> üü¢ Green (‚â•80%), üü° Orange (60-79%), üî¥ Red (<60%)</li>
                <li><strong>Real-time accuracy calculation:</strong> Shows "71% Complete (10/14 fields)" with dynamic color coding</li>
                <li><strong>Multiple signer support:</strong> Displays Signer 1, Signer 2, etc. with all details (Name, SSN, DOB, Address, Phone, Email)</li>
                <li><strong>Smart signer grouping:</strong> Only shows signer headers when they have actual data</li>
                <li><strong>Edit mode:</strong> Click fields to edit, save changes that persist across sessions</li>
                <li><strong>S3 cache integration:</strong> Saves edited data to S3 for persistence</li>
                <li><strong>Clear cache button:</strong> Re-extract all pages with updated prompts</li>
                <li><strong>Supporting documents table:</strong> Shows DocumentType and Details for each supporting doc</li>
            </ul>
            
            <div style="background: #f0f9ff; padding: 20px; border-radius: 10px; border-left: 4px solid #3b82f6; margin-top: 20px;">
                <h4 style="color: #1e40af; margin-bottom: 10px;">‚ú® New Features: Page-by-Page Viewer</h4>
                <p style="line-height: 1.8; color: #666;">
                    The enhanced document viewer provides a powerful interface for reviewing and editing extracted data:
                </p>
                <ul style="line-height: 1.8; margin-left: 20px; color: #666; margin-top: 10px;">
                    <li><strong>Split-screen layout:</strong> Document image (70%) + extracted data panel (30%)</li>
                    <li><strong>Account navigation:</strong> Switch between accounts in left sidebar</li>
                    <li><strong>Page navigation:</strong> Previous/Next buttons with keyboard shortcuts (‚Üê ‚Üí)</li>
                    <li><strong>Collapsible sidebar:</strong> Toggle page list for more viewing space</li>
                    <li><strong>Edit mode:</strong> Click "üìù Edit Page" to enable field editing</li>
                    <li><strong>Inline editing:</strong> Click any field value to edit in place</li>
                    <li><strong>Persistent saves:</strong> Changes saved to S3 cache and survive page refreshes</li>
                    <li><strong>Clear cache:</strong> "üîÑ Clear Cache" button re-extracts all pages with updated prompts</li>
                    <li><strong>Download options:</strong> Export single page or complete document as JSON</li>
                    <li><strong>Smart field filtering:</strong> Automatically hides empty/N/A fields for cleaner display</li>
                </ul>
            </div>
            
            <div style="background: #fef2f2; padding: 20px; border-radius: 10px; border-left: 4px solid #ef4444; margin-top: 20px;">
                <h4 style="color: #dc2626; margin-bottom: 10px;">‚ö†Ô∏è Data Quality & Accuracy Tracking</h4>
                <p style="line-height: 1.8; color: #666;">
                    The system provides real-time accuracy tracking and visual indicators for data quality:
                </p>
                <ul style="line-height: 1.8; margin-left: 20px; color: #666; margin-top: 10px;">
                    <li><strong>Dynamic accuracy calculation:</strong> (Filled Fields / Total Fields) √ó 100%</li>
                    <li><strong>Color-coded badges:</strong> Green (‚â•80%), Orange (60-79%), Red (<60%)</li>
                    <li><strong>Field count display:</strong> Shows "10/14 fields" for quick assessment</li>
                    <li><strong>Per-page accuracy:</strong> Each page shows its own completion percentage</li>
                    <li><strong>Account-level accuracy:</strong> Overall accuracy across all pages for each account</li>
                    <li><strong>Visual progress indicators:</strong> Styled badges with background colors matching accuracy level</li>
                </ul>
                <p style="line-height: 1.8; color: #666; margin-top: 10px;">
                    This ensures data quality issues are immediately visible and actionable, enabling efficient human review and correction.
                </p>
            </div>
        </div>

        <!-- Optimizations Section -->
        <div id="optimizations" class="content-section">
            <h2 class="section-title">‚ö° Performance & Cost Optimizations</h2>
            
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 15px; color: white; margin-bottom: 30px;">
                <h3 style="color: white; margin-bottom: 15px;">üéØ Optimization Results</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;">4-6x</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">Faster Processing</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;">50%</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">Cost Reduction</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;">66%</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">Fewer OCR Calls</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;">99.99%</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">Cheaper Re-views</div>
                    </div>
                </div>
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">üöÄ</div>
                    <h3>Parallel Processing</h3>
                    <p><strong>Speed Improvement: 4-6x faster</strong></p>
                    <ul style="text-align: left; margin-top: 10px;">
                        <li><strong>Page Scanning:</strong> Up to 10 pages processed simultaneously</li>
                        <li><strong>LLM Extraction:</strong> Up to 5 pages extracted in parallel</li>
                        <li><strong>ThreadPoolExecutor:</strong> Efficient multi-threading</li>
                        <li><strong>Result:</strong> 10-page doc: 65s ‚Üí 15s</li>
                        <li><strong>Result:</strong> 50-page doc: 5-6min ‚Üí 45-60s</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üíæ</div>
                    <h3>OCR Text Caching</h3>
                    <p><strong>Cost Reduction: 66% fewer OCR calls</strong></p>
                    <ul style="text-align: left; margin-top: 10px;">
                        <li><strong>Before:</strong> 3-4 OCR passes per page</li>
                        <li><strong>After:</strong> 1 OCR pass per page (cached)</li>
                        <li><strong>Cache Location:</strong> S3 bucket</li>
                        <li><strong>Cache Key:</strong> ocr_cache/{doc_id}/text_cache.json</li>
                        <li><strong>Reused By:</strong> Scanning, pre-caching, page viewing</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <h3>Smart Document Detection</h3>
                    <p><strong>Eliminates redundant full-document OCR</strong></p>
                    <ul style="text-align: left; margin-top: 10px;">
                        <li><strong>Quick First-Page Scan:</strong> Detects loan documents</li>
                        <li><strong>Skip Full OCR:</strong> Uses fast PyMuPDF extraction</li>
                        <li><strong>Page-Level OCR:</strong> Only when actually needed</li>
                        <li><strong>Savings:</strong> ~30% on loan documents</li>
                        <li><strong>Time Saved:</strong> 10-15 seconds per document</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3>Resolution Optimization</h3>
                    <p><strong>30% faster OCR processing</strong></p>
                    <ul style="text-align: left; margin-top: 10px;">
                        <li><strong>Scanning:</strong> 1x resolution (72 DPI)</li>
                        <li><strong>Final Extraction:</strong> 2x resolution (144 DPI)</li>
                        <li><strong>Rationale:</strong> Account detection doesn't need high-res</li>
                        <li><strong>Benefit:</strong> Smaller images, faster processing</li>
                        <li><strong>Quality:</strong> No accuracy loss</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üîÑ</div>
                    <h3>LLM Response Caching</h3>
                    <p><strong>99.99% cost reduction on re-views</strong></p>
                    <ul style="text-align: left; margin-top: 10px;">
                        <li><strong>First View:</strong> Extract with LLM ($0.0135/page)</li>
                        <li><strong>Subsequent Views:</strong> Load from S3 ($0.0000004/page)</li>
                        <li><strong>Cache Duration:</strong> Permanent (until cleared)</li>
                        <li><strong>Cache Key:</strong> page_data/{doc_id}/account_{X}/page_{Y}.json</li>
                        <li><strong>Benefit:</strong> Instant page loads after first view</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üîß</div>
                    <h3>Automatic Data Flattening</h3>
                    <p><strong>Fixes nested object issues</strong></p>
                    <ul style="text-align: left; margin-top: 10px;">
                        <li><strong>Problem:</strong> LLM returns nested signer objects</li>
                        <li><strong>Solution:</strong> flatten_nested_objects() function</li>
                        <li><strong>Applied:</strong> On extraction AND cache loading</li>
                        <li><strong>Format:</strong> Signer1: {Name: "John"} ‚Üí Signer1_Name: "John"</li>
                        <li><strong>Benefit:</strong> Consistent data structure</li>
                    </ul>
                </div>
            </div>

            <div style="background: #f0fdf4; padding: 25px; border-radius: 15px; border-left: 4px solid #10b981; margin-top: 30px;">
                <h3 style="color: #059669; margin-bottom: 15px;">üí∞ Cost Analysis Per Page</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div>
                        <h4 style="color: #059669; margin-bottom: 10px;">First Time Processing</h4>
                        <ul style="line-height: 1.8; color: #666;">
                            <li><strong>OCR (Textract):</strong> $0.0015</li>
                            <li><strong>LLM (Claude 3.5 Sonnet):</strong> $0.0135</li>
                            <li><strong>S3 Storage:</strong> $0.000005</li>
                            <li><strong>Total:</strong> <span style="color: #059669; font-weight: bold;">$0.015 per page</span></li>
                            <li><strong>Time:</strong> <span style="color: #059669; font-weight: bold;">3-5 seconds</span></li>
                        </ul>
                    </div>
                    <div>
                        <h4 style="color: #059669; margin-bottom: 10px;">Subsequent Views (Cached)</h4>
                        <ul style="line-height: 1.8; color: #666;">
                            <li><strong>S3 GET Request:</strong> $0.0000004</li>
                            <li><strong>OCR:</strong> $0 (cached)</li>
                            <li><strong>LLM:</strong> $0 (cached)</li>
                            <li><strong>Total:</strong> <span style="color: #059669; font-weight: bold;">~$0 (free)</span></li>
                            <li><strong>Time:</strong> <span style="color: #059669; font-weight: bold;">&lt;0.1 seconds</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div style="background: #eff6ff; padding: 25px; border-radius: 15px; border-left: 4px solid #3b82f6; margin-top: 30px;">
                <h3 style="color: #1e40af; margin-bottom: 15px;">üìà Monthly Cost Projections</h3>
                <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                    <thead>
                        <tr style="background: #dbeafe;">
                            <th style="padding: 12px; text-align: left; border: 1px solid #93c5fd;">Scenario</th>
                            <th style="padding: 12px; text-align: right; border: 1px solid #93c5fd;">Before</th>
                            <th style="padding: 12px; text-align: right; border: 1px solid #93c5fd;">After</th>
                            <th style="padding: 12px; text-align: right; border: 1px solid #93c5fd;">Savings</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #93c5fd;"><strong>1,000 docs/month (10 pages)</strong></td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #93c5fd;">$810/mo</td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #93c5fd; color: #059669; font-weight: bold;">$150/mo</td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #93c5fd; color: #059669; font-weight: bold;">$660/mo</td>
                        </tr>
                        <tr style="background: #f0f9ff;">
                            <td style="padding: 12px; border: 1px solid #93c5fd;"><strong>500 docs/month (25 pages)</strong></td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #93c5fd;">$1,012/mo</td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #93c5fd; color: #059669; font-weight: bold;">$187/mo</td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #93c5fd; color: #059669; font-weight: bold;">$825/mo</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #93c5fd;"><strong>Annual Savings</strong></td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #93c5fd;">-</td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #93c5fd;">-</td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #93c5fd; color: #059669; font-weight: bold; font-size: 1.1em;">$7,920 - $9,900</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="background: #fef3c7; padding: 25px; border-radius: 15px; border-left: 4px solid #f59e0b; margin-top: 30px;">
                <h3 style="color: #d97706; margin-bottom: 15px;">‚öôÔ∏è Technical Implementation</h3>
                <div class="step-list">
                    <div class="step-item">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Parallel Processing with ThreadPoolExecutor</h4>
                            <pre style="background: white; padding: 15px; border-radius: 8px; overflow-x: auto; margin-top: 10px;"><code>from concurrent.futures import ThreadPoolExecutor, as_completed

# Process up to 10 pages simultaneously
max_workers = min(10, total_pages)
with ThreadPoolExecutor(max_workers=max_workers) as executor:
    futures = [executor.submit(process_page, args) for args in page_args]
    for future in as_completed(futures):
        result = future.result()</code></pre>
                        </div>
                    </div>

                    <div class="step-item">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>OCR Text Caching in S3</h4>
                            <pre style="background: white; padding: 15px; border-radius: 8px; overflow-x: auto; margin-top: 10px;"><code># Save OCR cache
cache_key = f"ocr_cache/{doc_id}/text_cache.json"
s3_client.put_object(
    Bucket=S3_BUCKET,
    Key=cache_key,
    Body=json.dumps(ocr_text_cache),
    ContentType='application/json'
)

# Reuse cached OCR text
cache_response = s3_client.get_object(Bucket=S3_BUCKET, Key=cache_key)
ocr_cache = json.loads(cache_response['Body'].read())</code></pre>
                        </div>
                    </div>

                    <div class="step-item">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Smart Document Detection</h4>
                            <pre style="background: white; padding: 15px; border-radius: 8px; overflow-x: auto; margin-top: 10px;"><code># Quick first-page scan
pdf_doc = fitz.open(pdf_path)
first_page_text = pdf_doc[0].get_text()

# Detect loan document
if "ACCOUNT NUMBER" in first_page_text and "ACCOUNT HOLDER" in first_page_text:
    is_loan_document = True
    # Skip expensive full-document OCR
    # Use fast PyMuPDF extraction instead</code></pre>
                        </div>
                    </div>

                    <div class="step-item">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Automatic Data Flattening</h4>
                            <pre style="background: white; padding: 15px; border-radius: 8px; overflow-x: auto; margin-top: 10px;"><code>def flatten_nested_objects(data):
    """Flatten Signer1: {Name: "John"} ‚Üí Signer1_Name: "John" """
    flattened = {}
    for key, value in data.items():
        if key.startswith("Signer") and isinstance(value, dict):
            for sub_key, sub_value in value.items():
                flattened[f"{key}_{sub_key}"] = sub_value
        else:
            flattened[key] = value
    return flattened

# Apply on extraction AND cache loading
parsed = flatten_nested_objects(parsed)</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <div style="background: #fef2f2; padding: 25px; border-radius: 15px; border-left: 4px solid #ef4444; margin-top: 30px;">
                <h3 style="color: #dc2626; margin-bottom: 15px;">üéØ Key Takeaways</h3>
                <ul style="line-height: 2; color: #666; font-size: 1.05em;">
                    <li><strong>First processing:</strong> $0.015/page, 3-5 seconds</li>
                    <li><strong>Cached views:</strong> ~$0/page, &lt;0.1 seconds (instant)</li>
                    <li><strong>Parallel processing:</strong> 4-6x faster than sequential</li>
                    <li><strong>OCR caching:</strong> 66% reduction in OCR calls</li>
                    <li><strong>Smart detection:</strong> Skips unnecessary full-document OCR</li>
                    <li><strong>Monthly savings:</strong> $660-$825 for typical usage</li>
                    <li><strong>Annual savings:</strong> $7,920-$9,900</li>
                    <li><strong>ROI:</strong> Immediate (no upfront investment)</li>
                </ul>
            </div>
        </div>

        <!-- Architecture Section -->
        <div id="architecture" class="content-section">
            <h2 class="section-title">System Architecture</h2>
            
            <div class="architecture-diagram">
                <h3 style="color: var(--primary); margin-bottom: 20px;">Processing Flow</h3>
                
                <div class="flow-container">
                    <div class="flow-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>File Upload & Format Detection</h3>
                            <p>User uploads document (PDF, PNG, JPG, JPEG, or TXT). System automatically detects file type and determines if OCR is needed.</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>OCR Processing (3-Tier Approach)</h3>
                            <p><strong>Tier 1:</strong> Amazon Textract Sync API (fast, for simple PDFs/images)<br>
                            <strong>Tier 2:</strong> Amazon Textract Async API (robust, for scanned/multi-page PDFs)<br>
                            <strong>Tier 3:</strong> PyPDF2 Fallback (for text-based PDFs when Textract fails)</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>Text Extraction & Storage</h3>
                            <p>Extracted text is saved to ocr_results/ directory with timestamp. File path is stored for reference and debugging.</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3>Document Type Detection (Hybrid)</h3>
                            <p><strong>Keyword Matching:</strong> Fast detection using 12 document type definitions with keywords<br>
                            <strong>AI Classification:</strong> Claude 3.5 Sonnet for nuanced cases<br>
                            Identifies document type and retrieves expected fields list.</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h3>Basic Field Extraction (Up to 20 Fields)</h3>
                            <p>AI extracts the most important fields with descriptive names (e.g., "full_name", "document_number"). Prioritizes IDs, names, dates, amounts, and contact info.</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-number">6</div>
                        <div class="step-content">
                            <h3>Full Document Analysis</h3>
                            <p>Claude 3.5 Sonnet extracts ALL relevant fields specific to the detected document type. Uses document-specific prompts with expected field lists.</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-number">7</div>
                        <div class="step-content">
                            <h3>Accuracy Calculation & Quality Assessment</h3>
                            <p>System calculates accuracy score based on filled vs. total fields. Color-coded indicators (green/orange/red) show data quality at a glance.</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-number">8</div>
                        <div class="step-content">
                            <h3>Persistent Storage</h3>
                            <p>Document metadata, extracted fields, and processing info saved to processed_documents.json. Data persists across server restarts.</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-number">9</div>
                        <div class="step-content">
                            <h3>Dashboard Display</h3>
                            <p>All processed documents shown in comprehensive dashboard with tabs (All/Today/OCR). Click any document to view full details including document type info and all extracted fields.</p>
                        </div>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--primary); margin: 30px 0 20px 0;">Component Structure</h3>
            
            <div class="code-block">
<span class="comment">// Backend (Flask + AWS Services)</span>
universal_idp.py
‚îú‚îÄ‚îÄ <span class="function">extract_text_with_textract()</span>  <span class="comment"># 3-tier OCR processing</span>
‚îú‚îÄ‚îÄ <span class="function">extract_text_with_textract_async()</span>  <span class="comment"># Async Textract for scanned PDFs</span>
‚îú‚îÄ‚îÄ <span class="function">try_extract_pdf_with_pypdf()</span>  <span class="comment"># PyPDF2 fallback</span>
‚îú‚îÄ‚îÄ <span class="function">detect_document_type()</span>  <span class="comment"># Hybrid keyword + AI detection</span>
‚îú‚îÄ‚îÄ <span class="function">extract_basic_fields()</span>  <span class="comment"># Extract up to 20 key fields</span>
‚îú‚îÄ‚îÄ <span class="function">detect_and_extract_documents()</span>  <span class="comment"># Full AI extraction</span>
‚îú‚îÄ‚îÄ <span class="function">process_job()</span>  <span class="comment"># Background worker</span>
‚îú‚îÄ‚îÄ <span class="function">load_documents_db()</span>  <span class="comment"># Load persistent storage</span>
‚îî‚îÄ‚îÄ <span class="function">save_documents_db()</span>  <span class="comment"># Save to JSON</span>

<span class="comment">// Frontend - Upload Page</span>
templates/universal_document_processor.html
‚îú‚îÄ‚îÄ <span class="function">processDocument()</span>  <span class="comment"># Upload & initiate processing</span>
‚îú‚îÄ‚îÄ <span class="function">pollStatus()</span>  <span class="comment"># Real-time status polling</span>
‚îú‚îÄ‚îÄ <span class="function">displayDocuments()</span>  <span class="comment"># Show results with type info</span>
‚îî‚îÄ‚îÄ <span class="function">openDocument()</span>  <span class="comment"># Modal with full details</span>

<span class="comment">// Frontend - Dashboard</span>
templates/universal_dashboard.html
‚îú‚îÄ‚îÄ <span class="function">loadDocuments()</span>  <span class="comment"># Fetch all processed docs</span>
‚îú‚îÄ‚îÄ <span class="function">renderDocuments()</span>  <span class="comment"># Display in tabs</span>
‚îú‚îÄ‚îÄ <span class="function">createDocumentCard()</span>  <span class="comment"># Card with preview</span>
‚îî‚îÄ‚îÄ <span class="function">switchTab()</span>  <span class="comment"># All/Today/OCR tabs</span>

<span class="comment">// Supported Document Types (12+)</span>
SUPPORTED_DOCUMENT_TYPES = {
  marriage_certificate, death_certificate, business_card,
  invoice, loan_document, drivers_license, passport,
  contract, receipt, tax_form, medical_record, insurance_policy
}

<span class="comment">// OCR Processing Tiers</span>
Tier 1: Textract Sync (images <5MB, simple PDFs)
Tier 2: Textract Async (scanned PDFs, multi-page)
Tier 3: PyPDF2 (text-based PDFs fallback)

<span class="comment">// Storage</span>
processed_documents.json  <span class="comment"># Persistent document database</span>
ocr_results/              <span class="comment"># Extracted text files</span>
            </div>
        </div>

        <!-- Features Section -->
        <div id="features" class="content-section">
            <h2 class="section-title">‚ú® Key Features</h2>
            
            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">üìÑ Universal Document Support</h3>
            <ul style="line-height: 1.8; margin-left: 20px;">
                <li><strong>12+ Document Types:</strong> Marriage/Death Certificates, Business Cards, Invoices, Receipts, Loan Documents, Driver's Licenses, Passports, Contracts, Tax Forms, Medical Records, Insurance Policies</li>
                <li><strong>Automatic Type Detection:</strong> Hybrid approach using keyword matching + AI classification</li>
                <li><strong>Document-Specific Extraction:</strong> Each type has predefined expected fields</li>
                <li><strong>Visual Indicators:</strong> Icons and badges show document type and support status</li>
            </ul>

            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">üîç Advanced OCR Processing</h3>
            <ul style="line-height: 1.8; margin-left: 20px;">
                <li><strong>Amazon Textract Integration:</strong> Industry-leading OCR for scanned documents</li>
                <li><strong>3-Tier Processing:</strong>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>Tier 1: Sync API for fast processing (images <5MB, simple PDFs)</li>
                        <li>Tier 2: Async API for robust processing (scanned/multi-page PDFs, 1-2 min)</li>
                        <li>Tier 3: PyPDF2 fallback for text-based PDFs</li>
                    </ul>
                </li>
                <li><strong>Multi-Format Support:</strong> PDF, PNG, JPG, JPEG, TXT</li>
                <li><strong>Smart Fallback:</strong> Automatically tries alternative methods if primary fails</li>
                <li><strong>Text Preservation:</strong> All extracted text saved to ocr_results/ directory</li>
            </ul>

            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">ü§ñ AI-Powered Field Extraction</h3>
            <ul style="line-height: 1.8; margin-left: 20px;">
                <li><strong>Claude 3.5 Sonnet</strong> via AWS Bedrock for intelligent extraction</li>
                <li><strong>Up to 20 Key Fields:</strong> Extracts most important information with descriptive names</li>
                <li><strong>Prioritized Extraction:</strong> IDs, names, dates, amounts, contact info first</li>
                <li><strong>Document-Specific Prompts:</strong> Tailored extraction based on detected type</li>
                <li><strong>Context-Aware:</strong> Understands document structure and relationships</li>
            </ul>

            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">üìä Quality Assessment</h3>
            <ul style="line-height: 1.8; margin-left: 20px;">
                <li><strong>Automatic Accuracy Scoring:</strong> (Filled Fields / Total Fields) √ó 100%</li>
                <li><strong>Visual Indicators:</strong>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>üü¢ Green (80-100%): High accuracy - Comprehensive extraction</li>
                        <li>üü° Orange (60-79%): Medium accuracy - Most fields extracted</li>
                        <li>üî¥ Red (0-59%): Low accuracy - Limited extraction</li>
                    </ul>
                </li>
                <li><strong>Field-Level Validation:</strong> Shows which fields are filled vs. missing</li>
                <li><strong>Real-Time Display:</strong> Progress bars and color-coded badges</li>
            </ul>

            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">üíæ Persistent Storage & Caching</h3>
            <ul style="line-height: 1.8; margin-left: 20px;">
                <li><strong>JSON Database:</strong> All processed documents saved to processed_documents.json</li>
                <li><strong>S3 Page Cache:</strong> Individual page extractions cached in S3 for fast retrieval</li>
                <li><strong>Cache Key Format:</strong> {document_id}/page_{page_index}_data.json</li>
                <li><strong>Edit Persistence:</strong> User edits saved to S3 cache and survive page refreshes</li>
                <li><strong>Cache Management:</strong> Clear cache button to force re-extraction with updated prompts</li>
                <li><strong>Comprehensive Dashboard:</strong> View all documents with filtering (All/Today/OCR)</li>
                <li><strong>Document Cards:</strong> Preview with filename, type, date, and key fields</li>
                <li><strong>Detailed View:</strong> Click any document to see full extraction results</li>
                <li><strong>Statistics:</strong> Total documents, today's count, OCR processed count</li>
                <li><strong>Persistent Across Restarts:</strong> Data survives server restarts</li>
            </ul>

            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">‚ö° Real-Time Processing</h3>
            <ul style="line-height: 1.8; margin-left: 20px;">
                <li><strong>Live Status Updates:</strong> Polling mechanism shows current processing step</li>
                <li><strong>Progress Indicators:</strong> 5% ‚Üí 10% ‚Üí 40% ‚Üí 70% ‚Üí 100%</li>
                <li><strong>Step-by-Step Display:</strong> Shows OCR, field extraction, document analysis</li>
                <li><strong>Error Handling:</strong> Detailed error messages and fallback attempts</li>
                <li><strong>Processing Time Estimates:</strong> Warns about 1-2 min for scanned PDFs</li>
            </ul>

            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">üõ°Ô∏è Robust Error Handling</h3>
            <ul style="line-height: 1.8; margin-left: 20px;">
                <li><strong>Automatic Fallbacks:</strong> Tries multiple OCR methods if one fails</li>
                <li><strong>Error Logging:</strong> Saves detailed error traces to log files</li>
                <li><strong>User-Friendly Messages:</strong> Clear explanations of what went wrong</li>
                <li><strong>Validation:</strong> Checks file format, size, and PDF integrity</li>
                <li><strong>Graceful Degradation:</strong> Partial results shown even if some steps fail</li>
            </ul>
        </div>

        <!-- API Section -->
        <div id="api" class="content-section">
            <h2 class="section-title">üîå API Endpoints</h2>
            
            <div class="api-endpoint">
                <span class="method get">GET</span>
                <span class="path">/</span>
                <div class="description">Main upload page - Universal document processor interface</div>
            </div>

            <div class="api-endpoint">
                <span class="method get">GET</span>
                <span class="path">/dashboard</span>
                <div class="description">Dashboard page - View all processed documents with tabs (All/Today/OCR)</div>
            </div>

            <div class="api-endpoint">
                <span class="method post">POST</span>
                <span class="path">/process</span>
                <div class="description">
                    <strong>Upload and process document</strong><br>
                    <strong>Accepts:</strong> multipart/form-data with file (PDF, PNG, JPG, JPEG, TXT)<br>
                    <strong>Returns:</strong> { "success": true, "job_id": "abc123", "use_ocr": true }<br>
                    <strong>Processing:</strong> Automatically detects format and applies appropriate OCR method
                </div>
            </div>

            <div class="api-endpoint">
                <span class="method get">GET</span>
                <span class="path">/status/:job_id</span>
                <div class="description">
                    <strong>Get real-time processing status</strong><br>
                    <strong>Returns:</strong> { "status": "Processing...", "progress": 40, "result": {...} }<br>
                    <strong>Polling:</strong> Frontend polls every 1 second until completion<br>
                    <strong>Includes:</strong> OCR file path, method used, basic fields, document type info
                </div>
            </div>

            <div class="api-endpoint">
                <span class="method get">GET</span>
                <span class="path">/api/documents</span>
                <div class="description">
                    <strong>Get all processed documents</strong><br>
                    <strong>Returns:</strong> { "documents": [...], "total": 42 }<br>
                    <strong>Data:</strong> Complete list from processed_documents.json
                </div>
            </div>

            <div class="api-endpoint">
                <span class="method get">GET</span>
                <span class="path">/api/document/:doc_id</span>
                <div class="description">
                    <strong>Get specific document details</strong><br>
                    <strong>Returns:</strong> { "success": true, "document": {...} }<br>
                    <strong>Includes:</strong> All extracted fields, OCR info, document type, accuracy scores
                </div>
            </div>

            <h3 style="color: var(--primary); margin: 30px 0 20px 0;">üìÑ New Page-Based API Endpoints</h3>

            <div class="api-endpoint">
                <span class="method get">GET</span>
                <span class="path">/api/document/:doc_id/pages</span>
                <div class="description">
                    <strong>Get all pages for a document</strong><br>
                    <strong>Returns:</strong> { "success": true, "pages": [...], "total_pages": 5, "has_accounts": true }<br>
                    <strong>Use case:</strong> Load page thumbnails and navigation
                </div>
            </div>

            <div class="api-endpoint">
                <span class="method get">GET</span>
                <span class="path">/api/document/:doc_id/page/:page_index</span>
                <div class="description">
                    <strong>Get page image</strong><br>
                    <strong>Returns:</strong> Image file (PNG/JPG)<br>
                    <strong>Use case:</strong> Display document page in viewer
                </div>
            </div>

            <div class="api-endpoint">
                <span class="method get">GET</span>
                <span class="path">/api/document/:doc_id/page/:page_index/extract</span>
                <div class="description">
                    <strong>Extract data from specific page</strong><br>
                    <strong>Returns:</strong> { "success": true, "data": {...}, "cached": true, "edited": false }<br>
                    <strong>Features:</strong> S3 caching, force re-extraction with ?force=true<br>
                    <strong>Use case:</strong> Get extracted fields for a single page
                </div>
            </div>

            <div class="api-endpoint">
                <span class="method post">POST</span>
                <span class="path">/api/document/:doc_id/page/:page_index/update</span>
                <div class="description">
                    <strong>Update page data (save edits)</strong><br>
                    <strong>Body:</strong> { "page_data": {...}, "account_index": 0 }<br>
                    <strong>Returns:</strong> { "success": true, "message": "Page data updated" }<br>
                    <strong>Features:</strong> Saves to S3 cache, persists across sessions<br>
                    <strong>Use case:</strong> Save user edits to extracted data
                </div>
            </div>

            <div class="api-endpoint">
                <span class="method post">POST</span>
                <span class="path">/api/document/:doc_id/clear-cache</span>
                <div class="description">
                    <strong>Clear all cached page data</strong><br>
                    <strong>Returns:</strong> { "success": true, "message": "Cleared 5 cached pages" }<br>
                    <strong>Use case:</strong> Force re-extraction with updated prompts
                </div>
            </div>

            <div class="api-endpoint">
                <span class="method get">GET</span>
                <span class="path">/api/document/:doc_id/account/:account_index/pages</span>
                <div class="description">
                    <strong>Get pages for specific account (loan docs)</strong><br>
                    <strong>Returns:</strong> { "success": true, "pages": [...], "total_pages": 3 }<br>
                    <strong>Use case:</strong> Navigate pages within a specific account
                </div>
            </div>

            <div class="api-endpoint">
                <span class="method get">GET</span>
                <span class="path">/api/document/:doc_id/account/:account_index/page/:page_index</span>
                <div class="description">
                    <strong>Get page image for specific account</strong><br>
                    <strong>Returns:</strong> Image file (PNG/JPG)<br>
                    <strong>Use case:</strong> Display account-specific page in viewer
                </div>
            </div>

            <div class="api-endpoint">
                <span class="method get">GET</span>
                <span class="path">/api/document/:doc_id/account/:account_index/page/:page_index/data</span>
                <div class="description">
                    <strong>Get extracted data for account page</strong><br>
                    <strong>Returns:</strong> { "success": true, "data": {...}, "cached": true }<br>
                    <strong>Use case:</strong> Display extracted fields for account page
                </div>
            </div>

            <h3 style="color: var(--primary); margin: 30px 0 20px 0;">Response Structure</h3>
            <div class="code-block">
<span class="comment">// Processing Status Response</span>
{
  <span class="string">"status"</span>: <span class="string">"‚úÖ Processing completed"</span>,
  <span class="string">"progress"</span>: 100,
  <span class="string">"ocr_file"</span>: <span class="string">"ocr_results/20251114_143022_document.pdf.txt"</span>,
  <span class="string">"ocr_method"</span>: <span class="string">"Amazon Textract"</span>,
  <span class="string">"result"</span>: {
    <span class="string">"basic_fields"</span>: {
      <span class="string">"full_name"</span>: <span class="string">"John Doe"</span>,
      <span class="string">"document_number"</span>: <span class="string">"MC-2024-12345"</span>,
      ...
    },
    <span class="string">"document_type_info"</span>: {
      <span class="string">"type"</span>: <span class="string">"marriage_certificate"</span>,
      <span class="string">"name"</span>: <span class="string">"Marriage Certificate"</span>,
      <span class="string">"icon"</span>: <span class="string">"üíç"</span>,
      <span class="string">"is_supported"</span>: true,
      <span class="string">"expected_fields"</span>: [...]
    },
    <span class="string">"documents"</span>: [{
      <span class="string">"document_type"</span>: <span class="string">"marriage_certificate"</span>,
      <span class="string">"extracted_fields"</span>: {...},
      <span class="string">"accuracy_score"</span>: 95.5
    }]
  }
}
            </div>
        </div>

        <!-- Tech Stack Section -->
        <div id="tech" class="content-section">
            <h2 class="section-title">üíª Tech Stack</h2>
            
            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">Backend Technologies</h3>
            <div class="tech-stack">
                <div class="tech-badge">Python 3.8+</div>
                <div class="tech-badge">Flask 3.1.0</div>
                <div class="tech-badge">AWS Bedrock</div>
                <div class="tech-badge">Amazon Textract</div>
                <div class="tech-badge">Amazon S3</div>
                <div class="tech-badge">Boto3</div>
                <div class="tech-badge">PyPDF2</div>
            </div>

            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">AI & ML</h3>
            <div class="tech-stack">
                <div class="tech-badge">Claude 3.5 Sonnet</div>
                <div class="tech-badge">Amazon Textract OCR</div>
                <div class="tech-badge">NLP Field Extraction</div>
                <div class="tech-badge">Document Classification</div>
            </div>

            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">Frontend Technologies</h3>
            <div class="tech-stack">
                <div class="tech-badge">HTML5</div>
                <div class="tech-badge">CSS3</div>
                <div class="tech-badge">JavaScript ES6+</div>
                <div class="tech-badge">Fetch API</div>
                <div class="tech-badge">Inter Font</div>
            </div>

            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">Storage & Data</h3>
            <div class="tech-stack">
                <div class="tech-badge">JSON Database</div>
                <div class="tech-badge">File System Storage</div>
                <div class="tech-badge">S3 Object Storage</div>
            </div>

            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">Key Dependencies</h3>
            <div class="code-block">
boto3>=1.34.0          <span class="comment"># AWS SDK</span>
flask>=3.1.0           <span class="comment"># Web framework</span>
PyPDF2>=3.0.0          <span class="comment"># PDF text extraction</span>
flask-cors>=4.0.0      <span class="comment"># CORS support</span>
            </div>

            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">AWS Services Configuration</h3>
            <div class="code-block">
<span class="comment"># AWS Region</span>
AWS_REGION = <span class="string">"us-east-1"</span>

<span class="comment"># Bedrock Model</span>
MODEL_ID = <span class="string">"us.anthropic.claude-3-5-sonnet-20241022-v2:0"</span>

<span class="comment"># S3 Bucket for Textract</span>
S3_BUCKET = <span class="string">"awsidpdocs"</span>

<span class="comment"># Services</span>
bedrock = boto3.client(<span class="string">"bedrock-runtime"</span>)
textract = boto3.client(<span class="string">"textract"</span>)
s3_client = boto3.client(<span class="string">"s3"</span>)
            </div>
        </div>

        <!-- Setup Section -->
        <div id="setup" class="content-section">
            <h2 class="section-title">‚öôÔ∏è Setup Guide</h2>
            
            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">Prerequisites</h3>
            <ul style="line-height: 1.8; margin-left: 20px;">
                <li>Python 3.8 or higher</li>
                <li>AWS Account with Bedrock and Textract access</li>
                <li>AWS CLI configured with credentials</li>
                <li>S3 bucket created (e.g., "awsidpdocs")</li>
            </ul>

            <h3 style="color: var(--primary); margin: 20px 0 15px 0;">Installation Steps</h3>
            
            <div class="flow-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h3>Clone Repository</h3>
                    <div class="code-block">
git clone &lt;repository-url&gt;
cd universal-idp
                    </div>
                </div>
            </div>

            <div class="flow-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h3>Install Dependencies</h3>
                    <div class="code-block">
pip install -r requirement.txt
                    </div>
                </div>
            </div>

            <div class="flow-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h3>Configure AWS Credentials</h3>
                    <div class="code-block">
aws configure
<span class="comment"># Enter your AWS Access Key ID</span>
<span class="comment"># Enter your AWS Secret Access Key</span>
<span class="comment"># Default region: us-east-1</span>
                    </div>
                </div>
            </div>

            <div class="flow-step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h3>Create S3 Bucket</h3>
                    <div class="code-block">
aws s3 mb s3://awsidpdocs --region us-east-1
                    </div>
                </div>
            </div>

            <div class="flow-step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h3>Update Configuration</h3>
                    <div class="code-block">
<span class="comment"># Edit universal_idp.py</span>
S3_BUCKET = <span class="string">"awsidpdocs"</span>  <span class="comment"># Your bucket name</span>
AWS_REGION = <span class="string">"us-east-1"</span>  <span class="comment"># Your region</span>
                    </div>
                </div>
            </div>

            <div class="flow-step">
                <div class="step-number">6</div>
                <div class="step-content">
                    <h3>Run the Application</h3>
                    <div class="code-block">
python universal_idp.py
                    </div>
                </div>
            </div>

            <div class="flow-step">
                <div class="step-number">7</div>
                <div class="step-content">
                    <h3>Access the Application</h3>
                    <div class="code-block">
<span class="comment"># Upload Page</span>
http://localhost:5015/

<span class="comment"># Dashboard</span>
http://localhost:5015/dashboard

<span class="comment"># Documentation</span>
http://localhost:5015/codebase
                    </div>
                </div>
            </div>

            <h3 style="color: var(--primary); margin: 30px 0 15px 0;">AWS Permissions Required</h3>
            <div class="code-block">
{
  <span class="string">"Version"</span>: <span class="string">"2012-10-17"</span>,
  <span class="string">"Statement"</span>: [
    {
      <span class="string">"Effect"</span>: <span class="string">"Allow"</span>,
      <span class="string">"Action"</span>: [
        <span class="string">"bedrock:InvokeModel"</span>,
        <span class="string">"textract:DetectDocumentText"</span>,
        <span class="string">"textract:StartDocumentTextDetection"</span>,
        <span class="string">"textract:GetDocumentTextDetection"</span>,
        <span class="string">"s3:PutObject"</span>,
        <span class="string">"s3:GetObject"</span>
      ],
      <span class="string">"Resource"</span>: <span class="string">"*"</span>
    }
  ]
}
            </div>

            <h3 style="color: var(--primary); margin: 30px 0 15px 0;">Troubleshooting</h3>
            <ul style="line-height: 1.8; margin-left: 20px;">
                <li><strong>Textract Error:</strong> Ensure S3 bucket exists and has proper permissions</li>
                <li><strong>Bedrock Error:</strong> Check if Claude 3.5 Sonnet is enabled in your region</li>
                <li><strong>Import Error:</strong> Run pip install -r requirement.txt again</li>
                <li><strong>Port in Use:</strong> Change port in universal_idp.py (default: 5015)</li>
                <li><strong>Check Logs:</strong> Error logs saved to ocr_results/ directory</li>
            </ul>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Hide all content sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected section
            const selectedSection = document.getElementById(tabName);
            if (selectedSection) {
                selectedSection.classList.add('active');
            }

            // Add active class to clicked button
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
